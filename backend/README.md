# FurniSwap - Backend для электронной коммерции подержанной мебели

Backend API для приложения по продаже и обмену подержанной мебели, написанный на Go с использованием фреймворка Gin и базы данных PostgreSQL.

## Функциональность

1. **Аутентификация пользователей**:
   - Регистрация с подтверждением по email
   - Вход с двухфакторной аутентификацией
   - Профиль пользователя (имя, фамилия, email, город, аватар)

2. **Объявления**:
   - Создание, редактирование, удаление объявлений о продаже мебели
   - Фотографии для объявлений
   - Поиск объявлений по различным фильтрам
   - Категории товаров

3. **Избранное**:
   - Добавление объявлений в избранное
   - Просмотр списка избранных объявлений
   - Удаление объявлений из избранного

4. **Чаты и сообщения**:
   - Личные сообщения между покупателем и продавцом
   - Просмотр истории сообщений

5. **Покупки**:
   - Возможность покупки товаров из объявлений
   - История покупок в профиле пользователя
   - История продаж для продавцов
   - Автоматическое скрытие проданных товаров из общего списка

## Структура проекта

```
FurniSwap/
├── cmd/                # Точки входа в приложение
│   └── app/            
│       └── main.go     # Основная точка входа
├── internal/           # Внутренняя логика приложения
│   └── modules/        # Модульная структура приложения
│       ├── auth/       # Модуль аутентификации
│       ├── profile/    # Модуль профиля пользователя
│       ├── listing/    # Модуль объявлений
│       ├── favorite/   # Модуль избранных объявлений
│       ├── purchase/   # Модуль покупок
│       └── chat/       # Модуль чатов и сообщений
├── pkg/                # Пакеты, используемые в разных частях приложения
│   ├── config/         # Конфигурация приложения
│   ├── database/       # Взаимодействие с базой данных
│   └── middleware/     # Middleware, например для аутентификации
├── migrations/         # SQL миграции
├── uploads/            # Директория для загруженных изображений
├── go.mod              # Описание зависимостей
├── go.sum              # Контрольные суммы зависимостей
├── env.txt             # Пример файла с переменными окружения
└── docker-compose.yml  # Конфигурация Docker для PostgreSQL
```

## Требования

- Go 1.23+
- PostgreSQL 13+
- Docker и Docker Compose (опционально)

## Настройка и запуск

1. **Клонирование репозитория**:
   ```bash
   git clone https://github.com/yourusername/FurniSwap.git
   cd FurniSwap
   ```

2. **Настройка переменных окружения**:
   ```bash
   cp env.txt .env
   # Отредактируйте .env файл, указав ваши данные
   ```

3. **Запуск PostgreSQL через Docker**:
   ```bash
   docker-compose up -d
   ```

4. **Запуск приложения**:
   ```bash
   go run cmd/app/main.go
   ```

5. **Сервер будет доступен по адресу**: http://localhost:8080 (порт может отличаться в зависимости от настроек в .env файле)

## API Endpoints

### Публичные эндпоинты

- `GET /users/:id` - Получение публичной информации о пользователе
- `GET /categories` - Получение списка категорий товаров
- `GET /listings` - Получение списка объявлений с фильтрацией
- `GET /listings/:id` - Получение детальной информации об объявлении

### Аутентификация

- `POST /auth/register` - Регистрация нового пользователя
- `POST /auth/verify` - Проверка кода подтверждения email
- `POST /auth/login` - Вход в систему (отправляет код для второго фактора)
- `POST /auth/verify-2fa` - Проверка двухфакторной аутентификации

### Профиль пользователя (требуется аутентификация)

- `GET /api/profile` - Получение профиля пользователя
- `PUT /api/profile` - Обновление профиля пользователя
- `POST /api/profile/avatar` - Загрузка аватара пользователя

### Объявления (требуется аутентификация)

- `POST /api/listings` - Создание нового объявления
- `PUT /api/listings/:id` - Обновление объявления
- `DELETE /api/listings/:id` - Удаление объявления
- `POST /api/listings/:id/images` - Загрузка изображения для объявления
- `DELETE /api/listings/:id/images/:imageId` - Удаление изображения
- `PUT /api/listings/:id/images/:imageId/main` - Установка главного изображения

### Избранное (требуется аутентификация)

- `POST /api/listings/:id/favorite` - Добавление объявления в избранное
- `DELETE /api/listings/:id/favorite` - Удаление объявления из избранного
- `GET /api/listings/:id/favorite` - Проверка, добавлено ли объявление в избранное
- `GET /api/favorites` - Получение списка избранных объявлений

### Покупки (требуется аутентификация)

- `POST /api/listings/:id/buy` - Покупка товара
- `GET /api/purchases` - Получение истории покупок пользователя
- `GET /api/sales` - Получение истории продаж пользователя

### Чаты и сообщения (требуется аутентификация)

- `POST /api/chats` - Создание нового чата или отправка сообщения в существующий
- `GET /api/chats` - Получение списка чатов пользователя
- `GET /api/chats/:id` - Получение сообщений в чате
- `POST /api/chats/:id/messages` - Отправка сообщения в чат

## Тестирование API

Для тестирования API можно использовать коллекцию Postman, которая находится в файле `FurniSwap.postman_collection.json`.